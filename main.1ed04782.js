parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"ZCfc":[function(require,module,exports) {
var t=this&&this.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),n=this&&this.__spreadArray||function(t,n,e){if(e||2===arguments.length)for(var r,i=0,o=n.length;i<o;i++)!r&&i in n||(r||(r=Array.prototype.slice.call(n,0,i)),r[i]=n[i]);return t.concat(r||Array.prototype.slice.call(n))},e=function(t,n){return t.map(function(e,r){return t[r]*n[r]}).reduce(function(t,n){return t+n})},r=function(){function t(t,n){this.x=t,this.y=n}return t.prototype.rotateAround=function(t,n){var e=Math.PI/180*n,r=Math.cos(e),i=Math.sin(e),o=r*(this.x-t.x)+i*(this.y-t.y)+t.x,a=r*(this.y-t.y)-i*(this.x-t.x)+t.y;this.x=o,this.y=a},t.prototype.add=function(n){return new t(this.x+n.x,this.y+n.y)},t.prototype.diff=function(n){return new t(n.x-this.x,n.y-this.y)},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y},t.prototype.multiply=function(n){return new t(this.x*n,this.y*n)},t.prototype.flipX=function(){return new t(-this.x,this.y)},t.prototype.flipY=function(){return new t(this.x,-this.y)},t.zero=new t(0,0),t.unit=new t(1,1),t}();function i(t,n){var e=t.b.x-t.a.x,r=t.b.y-t.a.y,i=n.b.x-n.a.x,o=n.b.y-n.a.y,a=(-r*(t.a.x-n.a.x)+e*(t.a.y-n.a.y))/(-i*r+e*o),s=(i*(t.a.y-n.a.y)-o*(t.a.x-n.a.x))/(-i*r+e*o);return a>=0&&a<=1&&s>=0&&s<=1}var o=function(){function t(n,e,r,i){void 0===i&&(i=!1),this.position=n,this.rotation=e,this.scale=r,i||(this.zInd=t.nextZInd++)}return t.prototype.addPosition=function(n){this.add(new t(n,0,r.zero))},t.prototype.addRotation=function(n){for(this.add(new t(r.zero,n,r.zero));this.rotation<0;)this.add(new t(r.zero,360,r.zero));for(;this.rotation>=360;)this.add(new t(r.zero,-360,r.zero))},t.prototype.addScale=function(n){this.add(new t(r.zero,0,n)),this.scale.x<.1&&this.add(new t(r.zero,0,new r(.1-this.scale.x,0))),this.scale.y<.1&&this.add(new t(r.zero,0,new r(0,.1-this.scale.y)))},t.prototype.add=function(t){this.position=this.position.add(t.position),this.rotation=this.rotation+t.rotation,this.scale=this.scale.add(t.scale)},t.prototype.setZInd=function(t){this.zInd=t},t.nextZInd=0,t.default=new t(r.zero,0,r.unit),t.zero=new t(r.zero,0,r.zero),t}(),a=function(){return function(t){this.transform=t,this.selected=!1}}(),s=function(e){function o(t,n,i){void 0===n&&(n=null),void 0===i&&(i=!0);var o=e.call(this,t)||this;if(o.drawPoints=[],n)if(i){var a=n.reduce(function(t,n,e,i){return new r(t.x+n.x/i.length,t.y+n.y/i.length)},new r(0,0));o.points=n.map(function(t){return a.diff(t).multiply(50)})}else o.points=n;return o}return t(o,e),o.prototype.draw=function(t){var n=this,e=this.transform;this.drawPoints=this.points.map(function(t){var i=new r(n.transform.position.x+t.x*e.scale.x,n.transform.position.y+t.y*e.scale.y);return i.rotateAround(new r(e.position.x,e.position.y),n.transform.rotation),i});var i=t.strokeStyle;this.selected?t.strokeStyle="red":t.strokeStyle="black",t.beginPath(),t.moveTo(this.drawPoints[0].x,this.drawPoints[0].y);for(var o=1;o<this.drawPoints.length;o++)t.lineTo(this.drawPoints[o].x,this.drawPoints[o].y);t.lineTo(this.drawPoints[0].x,this.drawPoints[0].y),t.stroke(),t.strokeStyle=i},o.prototype.getPoints=function(){var t=this,n=this.transform;return this.drawPoints=this.points.map(function(e){var i=new r(t.transform.position.x+e.x*n.scale.x,t.transform.position.y+e.y*n.scale.y);return i.rotateAround(new r(n.position.x,n.position.y),t.transform.rotation),i}),this.drawPoints},o.prototype.getLines=function(){for(var t=this.getPoints(),n=[],e=0;e<t.length;e++)n.push({a:t[e],b:t[(e+1)%t.length]});return n},o.prototype.triangulate=function(){for(var t=[],e=n([],this.points,!0),r=e.length;e.length>3;){for(var i=0;i<e.length;i++){var a=0==i?e.length-1:i-1,s=i,u=(i+1)%e.length,l=[e[a],e[s],e[u]],c=Math.atan2(l[2].y-l[1].y,l[2].x-l[1].x)-Math.atan2(l[0].y-l[1].y,l[0].x-l[1].x);if(!(Math.abs(c)>=Math.PI)){for(var f=new o(this.transform,l,!1),h=0;h<e.length;h++)h!=a&&h!=s&&h!=u&&f.isPointInside(e[h]);t=t.concat(f),e.splice(i,1);break}}if(e.length==r)break;r=e.length}return t.push(new o(this.transform,[e[0],e[1],e[2]],!1)),t},o.prototype.isPointInside=function(t){for(var n=t.x,e=t.y,r=!1,i=0,o=this.drawPoints.length-1;i<this.drawPoints.length;o=i++){var a=this.drawPoints[i].x,s=this.drawPoints[i].y,u=this.drawPoints[o].x,l=this.drawPoints[o].y;s>e!=l>e&&n<(u-a)*(e-s)/(l-s)+a&&(r=!r)}return r},o.prototype.isIntersecting=function(t){if(!(t instanceof o))throw"Not implemented";for(var n=t,e=[],r=0;r<this.drawPoints.length;r++)e.push({a:this.drawPoints[r],b:this.drawPoints[(r+1)%this.drawPoints.length]});var a=[];for(r=0;r<n.drawPoints.length;r++)a.push({a:n.drawPoints[r],b:n.drawPoints[(r+1)%n.drawPoints.length]});for(var s=0,u=e;s<u.length;s++)for(var l=u[s],c=0,f=a;c<f.length;c++){if(i(l,f[c]))return!0}return!1},o}(a);function u(t,n,e){var r=g.strokeStyle,i=g.lineWidth;g.strokeStyle=e,g.lineWidth=1,g.beginPath(),g.moveTo(t.x,t.y),g.lineTo(n.x,n.y),g.stroke(),g.strokeStyle=r,g.lineWidth=i}function l(t,n){for(var e=t.b.diff(t.a),i=[],o=n.getPoints(),a=0;a<o.length;a++){var s=o[(a+1)%o.length],u=o[a],l=u.y-s.y,c=s.x-u.x;i.push(new r(l,c))}var f=0,h=1;for(a=0;a<o.length;a++){var d=i[a].dot(e);if(0!=d){var w=t.a.diff(o[a]),p=i[a].dot(w)/-d;d<0?f=Math.max(f,p):h=Math.min(h,p)}else{var y=o[a],v=o[(a+1)%o.length],x=t.a;(v.x-y.x)*(x.y-y.y)-(v.y-y.y)*(x.x-y.x)<0&&(f=1,h=-1)}}if(f>h)return[{a:t.a,b:t.b}];var g=t.a.add(t.a.diff(t.b).multiply(f)),m=t.a.add(t.a.diff(t.b).multiply(h));return 0==f&&1==h?[]:0==f?[{a:m,b:t.b}]:1==h?[{a:t.a,b:g}]:[{a:t.a,b:g},{a:m,b:t.b}]}var c,f,h,d=function(n){function e(t,e,i){var o=n.call(this,i)||this;o.points=[];var a=t/2,s=e/2;return o.points.push(new r(-a,+s)),o.points.push(new r(+a,+s)),o.points.push(new r(+a,-s)),o.points.push(new r(-a,-s)),o}return t(e,n),e}(s),w=function(n){function e(t,r,i){var o=n.call(this,e.SIZE,e.SIZE,t)||this;return o.glyph=r,o.clickCallback=i,o}return t(e,n),e.prototype.draw=function(t){n.prototype.draw.call(this,t),t.font=.8*e.SIZE+"px FontAwesome",t.textBaseline="middle",t.textAlign="center",t.fillText(this.glyph,this.transform.position.x,this.transform.position.y)},e.SIZE=40,e}(d);!function(t){t[t.Create=0]="Create",t[t.Edit=1]="Edit"}(c||(c={})),function(t){t[t.Move=0]="Move",t[t.Rotate=1]="Rotate",t[t.Scale=2]="Scale",t[t.Tabulate=3]="Tabulate"}(f||(f={})),function(t){t[t.Square=0]="Square",t[t.Triangle=1]="Triangle",t[t.Arrow=2]="Arrow",t[t.Star=3]="Star"}(h||(h={}));var p=c.Edit,y=f.Move,v=h.Square,x=document.querySelector("canvas");x.width=800,x.height=800;var g=x.getContext("2d"),m=[];function b(){return m.sort(function(t,n){return n.transform.zInd-t.transform.zInd})}function P(t){for(var n=0,e=b();n<e.length;n++){var r=e[n];if(r.isPointInside(t))return r}return null}function S(t){for(var n=0,e=X;n<e.length;n++){var r=e[n];if(r.isPointInside(t))return r}return null}function k(t,n){H&&(H.selected=!1,H=null),p=t,W.forEach(function(t){return t.selected=!1}),n.selected=!0,N()}var I=new w(new o(new r(75,25),0,r.unit),"",function(){return k(c.Create,I)}),z=new w(new o(new r(25,25),0,r.unit),"",function(){return k(c.Edit,z)});function T(t,n){H&&(H.selected=!1,H=null),y=t,Y.forEach(function(t){return t.selected=!1}),n.selected=!0,N()}z.selected=!0;var E=new w(new o(new r(25,75),0,r.unit),"",function(){return T(f.Move,E)});E.selected=!0;var A=new w(new o(new r(75,75),0,r.unit),"",function(){return T(f.Rotate,A)}),M=new w(new o(new r(125,75),0,r.unit),"",function(){return T(f.Scale,M)}),_=new w(new o(new r(175,75),0,r.unit),"",function(){return T(f.Tabulate,_)});function C(t,n){v=t,B.forEach(function(t){return t.selected=!1}),n.selected=!0,N()}var Z=new w(new o(new r(25,75),0,r.unit),"",function(){return C(h.Square,Z)});Z.selected=!0;var R=new w(new o(new r(75,75),0,r.unit),"",function(){return C(h.Triangle,R)}),L=new w(new o(new r(125,75),0,r.unit),"",function(){return C(h.Arrow,L)}),q=new w(new o(new r(175,75),0,r.unit),"",function(){return C(h.Star,q)}),O=null,j=null,W=[I,z],Y=[E,A,M,_],B=[Z,R,L,q],X=[],D=!1;function F(){D=!D,N()}function N(){g.clearRect(0,0,800,800),X=W;for(var t=0,n=X=p==c.Create?X.concat(B):X.concat(Y);t<n.length;t++){n[t].draw(g)}var e=b().reverse();if(e.length>0)for(var r=0;r<e.length;r++){var i=e[r].getLines();if(D)for(var o=0,a=i;o<a.length;o++){u((S=a[o]).a,S.b,"green")}for(var s=r+1;s<e.length;s++)for(var f=0,h=e[s].triangulate();f<h.length;f++){for(var d=h[f],w=[],y=0,v=i;y<v.length;y++){var x=v[y];w=w.concat(l(x,d))}i=w}for(var m=0,P=i;m<P.length;m++){var S;u((S=P[m]).a,S.b,e[r].selected?"red":"black")}}}function G(t){var n=x.getBoundingClientRect();return new r(t.clientX-n.left,t.clientY-n.top)}globalThis.switchDrawAllLines=F;var H=null;x.addEventListener("mousedown",function(t){var n=G(t),e=S(n);if(e)e.clickCallback();else{if(p==c.Edit){var i=P(n);if(y==f.Tabulate){if(i)if(null===H)(H=i).selected=!0;else{var a=i.transform.zInd;i.transform.setZInd(H.transform.zInd),H.transform.setZInd(a),H.selected=!1,H=null}}else i&&(O=i,j=n)}else{if(n.x<200&&n.y<100)return;switch(v){case h.Square:m.push(new s(new o(n,0,r.unit),[new r(1,-1),new r(1,1),new r(-1,1),new r(-1,-1)]));break;case h.Triangle:m.push(new s(new o(n,0,r.unit),[new r(1,1),new r(-1,1),new r(0,-1)]));break;case h.Arrow:m.push(new s(new o(n,0,r.unit),[new r(0,-1),new r(2,-2),new r(1,0),new r(1,-1)]));break;case h.Star:m.push(new s(new o(n,0,r.unit),[new r(0,-2.5),new r(.9,-.5),new r(3,-.5),new r(1.35,.5),new r(2.25,2.5),new r(0,1.5),new r(-2.25,2.5),new r(-1.35,.5),new r(-3,-.5),new r(-.9,-.5)].map(function(t){return t.multiply(.5)})))}}N()}}),x.addEventListener("mouseup",function(){O=null,j=null}),x.addEventListener("mouseleave",function(){O=null,j=null}),x.addEventListener("mousemove",function(t){if(O){var n=G(t),e=j.diff(n);switch(j=n,y){case f.Move:O.transform.addPosition(e);break;case f.Rotate:O.transform.addRotation(e.y);break;case f.Scale:O.transform.addScale(e.multiply(.01).flipY())}N()}}),N(),setTimeout(N,3e3),setTimeout(N,1e4);
},{}]},{},["ZCfc"], null)
//# sourceMappingURL=main.1ed04782.js.map